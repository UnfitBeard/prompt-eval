<div class="min-h-screen bg-gradient-to-b from-gray-50 to-white">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 px-6 py-8">
        <div class="max-w-7xl mx-auto">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <!-- Title & intro -->
                <div class="flex-1">
                    <p
                        class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-indigo-600 mb-2">
                        <span
                            class="px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-600 border border-indigo-100">Academy</span>
                        Prompt Engineering Curriculum
                    </p>
                    <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-3">
                        Prompt Engineering Courses
                    </h1>
                    <p class="text-lg text-gray-600 max-w-3xl">
                        Progress from fundamentals to advanced prompt orchestration with a
                        curated three‑course track designed for real‑world LLM applications.
                    </p>
                </div>

                <!-- Global XP / badges -->
                <div
                    class="w-full lg:w-auto min-w-[280px] bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-2xl shadow-lg p-5">
                    <div class="flex items-center justify-between gap-4 mb-3">
                        <div>
                            <p class="text-sm text-indigo-100">Your progress</p>
                            <p class="text-xl font-semibold">
                                {{ totalPoints }} XP
                            </p>
                        </div>
                        <div class="h-12 w-12 rounded-full bg-white/15 flex items-center justify-center">
                            <i class="fas fa-trophy text-xl"></i>
                        </div>
                    </div>
                    <div class="space-y-2 text-xs">
                        <p class="text-indigo-100">
                            Badges:
                            <ng-container *ngIf="earnedBadges.length; else noBadges">
                                <span *ngFor="let badge of earnedBadges; index as i"
                                    class="inline-flex items-center px-2 py-0.5 rounded-full bg-white/10 text-[11px] mr-1">
                                    <i class="fas fa-medal text-[10px] mr-1"></i>
                                    {{ badge }}
                                    <span *ngIf="i < earnedBadges.length - 1">,</span>
                                </span>
                            </ng-container>
                            <ng-template #noBadges>
                                <span class="italic text-indigo-100/80">No badges yet</span>
                            </ng-template>
                        </p>
                        <p class="text-indigo-100/90">
                            Complete modules in learning mode to earn XP and unlock badges.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Course selector -->
        <section class="mb-10">
            <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-5">
                <div>
                    <h2 class="text-xl font-semibold text-gray-900">Choose your course</h2>
                    <p class="text-sm text-gray-600">
                        Start with the basics, then specialize in RAG and advanced
                        techniques.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button *ngFor="let course of courses; trackBy: trackByCourseId" type="button"
                    (click)="selectCourse(course.id)" [class]="
            'group text-left rounded-2xl border shadow-sm transition-all duration-200 cursor-pointer hover:-translate-y-0.5 hover:shadow-lg ' +
            (selectedCourseId === course.id
              ? 'border-gray-900 bg-gray-900 text-white'
              : 'border-gray-200 bg-white text-gray-900')
          ">
                    <div class="p-4 h-full flex flex-col gap-3">
                        <div class="flex items-center justify-between gap-2">
                            <div class="flex items-center gap-2">
                                <span
                                    class="inline-flex items-center justify-center h-9 w-9 rounded-full bg-gray-900/5 group-[.bg-gray-900]:bg-white/10">
                                    <i class="fas" [ngClass]="{
                      'fa-seedling': course.id === 'basics',
                      'fa-database': course.id === 'rag',
                      'fa-brain': course.id === 'advanced'
                    }"></i>
                                </span>
                                <div>
                                    <p class="text-sm font-semibold" [ngClass]="{
                      'text-white': selectedCourseId === course.id,
                      'text-gray-900': selectedCourseId !== course.id
                    }">
                                        {{ course.title }}
                                    </p>
                                    <p class="text-xs" [ngClass]="{
                      'text-gray-300': selectedCourseId === course.id,
                      'text-gray-500': selectedCourseId !== course.id
                    }">
                                        {{ course.subtitle }}
                                    </p>
                                </div>
                            </div>

                            <span
                                class="inline-flex items-center px-2.5 py-1 rounded-full text-[11px] font-medium border"
                                [ngClass]="
                  selectedCourseId === course.id
                    ? 'border-white/30 bg-white/10 text-gray-50'
                    : 'border-gray-200 bg-gray-50 text-gray-700'
                ">
                                {{ getDifficultyLabel(course.difficulty) }}
                            </span>
                        </div>

                        <div class="flex items-center justify-between text-xs">
                            <span [ngClass]="{
                  'text-gray-300': selectedCourseId === course.id,
                  'text-gray-500': selectedCourseId !== course.id
                }">
                                {{ course.modules.length }} modules •
                                {{ formatHours(course.estimatedHours) }}
                            </span>

                            <span *ngIf="course.badge" class="inline-flex items-center gap-1 text-[11px] font-medium"
                                [ngClass]="{
                  'text-amber-300': selectedCourseId === course.id,
                  'text-amber-600': selectedCourseId !== course.id
                }">
                                <i class="fas fa-star text-[10px]"></i>
                                {{ course.badge }}
                            </span>
                        </div>
                    </div>
                </button>
            </div>
        </section>

        <!-- Selected course detail -->
        <section *ngIf="selectedCourse as course" class="space-y-8" id="course-detail">
            <!-- Overview card -->
            <div
                class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-start bg-white border border-gray-200 rounded-2xl shadow-sm p-6">
                <div class="lg:col-span-2 space-y-4">
                    <div class="flex items-center gap-2">
                        <span
                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[11px] font-medium border border-gray-200 text-gray-700 bg-gray-50">
                            {{ course.title }}
                        </span>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-[11px] font-medium"
                            [ngClass]="getDifficultyBadgeClasses(course.difficulty)">
                            {{ getDifficultyLabel(course.difficulty) }}
                        </span>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-900">
                        {{ course.subtitle }}
                    </h2>
                    <p class="text-sm text-gray-600">
                        {{ course.audience }}
                    </p>

                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 mb-2">
                            Key topics
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            <span *ngFor="let topic of course.keyTopics"
                                class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full bg-gray-100 text-xs text-gray-700">
                                <i class="fas fa-check text-[10px] text-emerald-600"></i>
                                {{ topic }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4 rounded-xl bg-gray-50 border border-dashed border-gray-200 p-4">
                    <h3 class="text-sm font-semibold text-gray-900">
                        Course snapshot
                    </h3>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-gray-500 text-xs">Modules</p>
                            <p class="font-semibold text-gray-900">
                                {{ course.modules.length }}
                            </p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">Estimated time</p>
                            <p class="font-semibold text-gray-900">
                                {{ formatHours(course.estimatedHours) }}
                            </p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">Track</p>
                            <p class="font-semibold text-gray-900">
                                {{
                                course.id === 'basics'
                                ? 'Foundations'
                                : course.id === 'rag'
                                ? 'RAG Systems'
                                : 'Advanced Techniques'
                                }}
                            </p>
                        </div>
                        <div>
                            <p class="text-gray-500 text-xs">Difficulty</p>
                            <p class="font-semibold text-gray-900">
                                {{ getDifficultyLabel(course.difficulty) }}
                            </p>
                        </div>
                    </div>

                    <div>
                        <p class="text-xs text-gray-500 mb-1">You will be able to…</p>
                        <ul class="space-y-1 text-xs text-gray-700">
                            <li *ngFor="let outcome of course.outcomes" class="flex gap-2">
                                <span class="mt-0.5 h-1.5 w-1.5 rounded-full bg-gray-400 flex-shrink-0"></span>
                                <span>{{ outcome }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Modules list -->
            <div class="bg-white border border-gray-200 rounded-2xl shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900">
                            Course modules ({{ course.modules.length }})
                        </h3>
                        <p class="text-xs text-gray-600">
                            Click “Open module” to enter learning mode with a split‑screen
                            lesson and practice question.
                        </p>
                    </div>
                </div>

                <ol class="divide-y divide-gray-100">
                    <li *ngFor="let module of course.modules; index as i; trackBy: trackByModuleId"
                        class="px-6 py-4 flex gap-4">
                        <div class="flex flex-col items-center w-8">
                            <div
                                class="h-7 w-7 rounded-full bg-gray-900 text-white text-xs font-semibold flex items-center justify-center">
                                {{ i + 1 }}
                            </div>
                            <div *ngIf="i < course.modules.length - 1" class="flex-1 w-px bg-gray-200 mt-1"></div>
                        </div>

                        <div class="flex-1 min-w-0">
                            <div class="flex flex-wrap items-start justify-between gap-2">
                                <div>
                                    <h4 class="text-sm font-semibold text-gray-900">
                                        {{ module.title }}
                                    </h4>
                                    <p class="mt-1 text-xs text-gray-600 line-clamp-2">
                                        {{ module.summary }}
                                    </p>
                                    <div class="mt-1 flex flex-wrap items-center gap-2 text-[11px]">
                                        <span *ngIf="module.focus"
                                            class="inline-flex items-center px-2 py-0.5 rounded-full bg-gray-100 text-gray-700">
                                            <i class="fas fa-tag text-[10px] mr-1 text-gray-500"></i>
                                            {{ module.focus }}
                                        </span>
                                        <span *ngIf="module.duration" class="inline-flex items-center text-gray-500">
                                            <i class="far fa-clock text-[11px] mr-1"></i>
                                            {{ module.duration }}
                                        </span>
                                        <span class="inline-flex items-center text-gray-500">
                                            <i class="fas fa-gem text-[10px] mr-1 text-amber-500"></i>
                                            {{ module.points }} XP
                                        </span>
                                    </div>
                                </div>

                                <div class="flex flex-col items-end gap-1 text-xs">
                                    <span *ngIf="getModuleProgress(module.id).completed"
                                        class="inline-flex items-center px-2 py-0.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-100">
                                        <i class="fas fa-check-circle text-[11px] mr-1"></i>
                                        Completed
                                    </span>

                                    <button type="button" (click)="openModule(course, module)"
                                        class="mt-1 inline-flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium border border-gray-200 text-gray-800 bg-white hover:bg-gray-50 transition-colors">
                                        <i class="fas fa-door-open text-[11px]"></i>
                                        Open module
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                </ol>
            </div>
        </section>
    </div>

    <!-- Learning mode FULL-SCREEN overlay -->
    <div *ngIf="isLearningModeOpen && activeModule as m" class="fixed inset-0 z-40 flex items-stretch justify-center">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/40" (click)="closeLearningMode()"></div>

        <!-- Content -->
        <div class="relative z-50 bg-white w-full h-full lg:rounded-none flex flex-col shadow-2xl">
            <!-- Overlay header -->
            <header
                class="flex items-center justify-between px-4 sm:px-6 py-3 border-b border-gray-200 bg-white/90 backdrop-blur">
                <div class="min-w-0">
                    <p class="text-[11px] uppercase tracking-wide text-gray-500 mb-0.5">
                        Learning mode
                    </p>
                    <h3 class="text-sm sm:text-base font-semibold text-gray-900 truncate">
                        {{ m.title }}
                    </h3>
                </div>
                <div class="flex items-center gap-3 text-xs sm:text-sm">
                    <span class="inline-flex items-center gap-1 text-gray-600">
                        <i class="fas fa-gem text-amber-500 text-[11px]"></i>
                        {{ m.points }} XP
                    </span>
                    <button type="button"
                        class="inline-flex items-center justify-center h-8 w-8 rounded-full border border-gray-200 text-gray-500 hover:bg-gray-100"
                        (click)="closeLearningMode()">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            </header>

            <!-- Split body -->
            <main
                class="flex-1 grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-gray-100 overflow-hidden">
                <!-- Left: lesson content -->
                <section class="p-4 sm:p-6 overflow-y-auto space-y-4">
                    <h4 class="text-base font-semibold text-gray-900">Lesson</h4>
                    <ng-container *ngIf="m.lessonMarkdown; else summaryFallback">
                        <pre class="whitespace-pre-wrap text-sm text-gray-800">
{{ cleanMarkdown(m.lessonMarkdown) }}
                        </pre>
                    </ng-container>
                    <ng-template #summaryFallback>
                        <p class="text-sm text-gray-700">
                            {{ m.summary }}
                        </p>
                    </ng-template>
                    <div class="rounded-lg bg-gray-50 border border-dashed border-gray-200 p-3 text-xs text-gray-600">
                        <p class="font-semibold text-gray-800 mb-1">
                            How to use this learning mode
                        </p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>
                                Read the summary and imagine real examples from your own work.
                            </li>
                            <li>
                                Try to restate the key idea in your own words before answering.
                            </li>
                            <li>
                                Answer the question on the right to unlock the next module.
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- Right: interactive MCQ -->
                <section class="p-4 sm:p-6 overflow-y-auto bg-gray-50 lg:bg-white space-y-4">
                    <h4 class="text-base font-semibold text-gray-900">
                        Practice question
                    </h4>

                    <div class="space-y-3 text-sm text-gray-800">
                        <p>{{ m.question.prompt }}</p>

                        <div class="space-y-2">
                            <button *ngFor="let option of m.question.options; index as idx" type="button"
                                (click)="selectAnswer(m, idx)"
                                class="w-full text-left px-3 py-2 rounded-lg border text-xs sm:text-sm flex items-start gap-2 transition-colors"
                                [ngClass]="{
                  'border-indigo-500 bg-indigo-50':
                    getSelectedAnswerIndex(m) === idx,
                  'border-gray-200 bg-white hover:bg-gray-50':
                    getSelectedAnswerIndex(m) !== idx
                }">
                                <span
                                    class="mt-0.5 inline-flex h-4 w-4 items-center justify-center rounded-full border text-[10px]"
                                    [ngClass]="{
                    'border-indigo-500 text-indigo-600':
                      getSelectedAnswerIndex(m) === idx,
                    'border-gray-300 text-gray-500':
                      getSelectedAnswerIndex(m) !== idx
                  }">
                                    {{ 'ABCD'[idx] }}
                                </span>
                                <span class="flex-1">{{ option }}</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mt-3 gap-3 text-xs">
                        <button type="button" (click)="submitAnswer(m)"
                            class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-900 text-white font-medium hover:bg-gray-800 transition-colors">
                            <i class="fas fa-check text-[11px]"></i>
                            Check answer
                        </button>

                        <div class="text-right text-gray-600">
                            <p>
                                Module XP:
                                <span class="font-semibold text-gray-900">
                                    {{ getModuleProgress(m.id).pointsAwarded }} /
                                    {{ m.points }}
                                </span>
                            </p>
                        </div>
                    </div>

                    <div class="mt-3 text-xs">
                        <ng-container [ngSwitch]="getModuleProgress(m.id).lastResult">
                            <p *ngSwitchCase="'correct'"
                                class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-emerald-50 text-emerald-800 border border-emerald-100">
                                <i class="fas fa-check-circle text-[12px]"></i>
                                Correct! {{ m.question.explanation }}
                            </p>
                            <p *ngSwitchCase="'incorrect'"
                                class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-rose-50 text-rose-800 border border-rose-100">
                                <i class="fas fa-times-circle text-[12px]"></i>
                                Not quite. Review the lesson content and try again.
                            </p>
                            <p *ngSwitchDefault class="text-gray-500">
                                Select an answer and click “Check answer” to see feedback.
                            </p>
                        </ng-container>
                    </div>
                </section>
            </main>

            <!-- Overlay footer: Next module gating -->
            <footer
                class="px-4 sm:px-6 py-3 border-t border-gray-200 bg-white flex flex-col sm:flex-row items-center justify-between gap-3 text-xs sm:text-sm">
                <div class="text-gray-600">
                    <ng-container *ngIf="getActiveCourse() as c">
                        <span class="font-medium text-gray-900">{{ c.title }}</span>
                        ·
                        <span>Module
                            {{ getModulePosition(c, m.id) }}
                            of {{ c.modules.length }}</span>
                    </ng-container>
                </div>

                <div class="flex items-center gap-2">
                    <button type="button"
                        class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 text-gray-700 bg-white hover:bg-gray-50"
                        (click)="closeLearningMode()">
                        <i class="fas fa-door-open text-[11px]"></i>
                        Exit
                    </button>

                    <button type="button" [disabled]="!canGoNext()" (click)="goToNextModule()"
                        class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg font-medium text-white transition-colors"
                        [ngClass]="
              canGoNext()
                ? 'bg-indigo-600 hover:bg-indigo-700'
                : 'bg-gray-300 cursor-not-allowed'
            ">
                        <span *ngIf="canGoNext(); else lockedNext">
                            Next module
                            <i class="fas fa-arrow-right text-[11px]"></i>
                        </span>
                        <ng-template #lockedNext>
                            <i class="fas fa-lock text-[11px]"></i>
                            Complete this module to unlock next
                        </ng-template>
                    </button>
                </div>
            </footer>
        </div>
    </div>
</div>